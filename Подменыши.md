Подменыши
=========

  
2016-09-14, 23:56  
 Жила-была переменная fTime. Она указывала на текущее время. Жила-была другая переменная -- fTime0. Она указывала на момент начала некоего процесса.   
   
 И ещё была длинная функция, в которой они обе жили.   
   
 Я смотрю на разницу в начале функции -- там всё ок. Вывожу её на экран на всякий случай.   
 Я смотрю на разницу в конце функции -- а там она другая! Этого быть не может, т.к. fTime0 в течение функции не меняется, а fTime обновляется только в начале цикла (большая часть функции -- тело цикла).   
   
 ОКАЗАЛОСЬ   
   
 что ближе к концу функции был вложенный цикл. И там была об'явлена ДРУГАЯ переменная fTime. По другому поводу и, ясное дело, с совершенно другим значением. Она перекрыла предыдущую без предупреждения. А вторую проверку я проводил как раз во вложенном цикле.   
   
 Си -- опасный язык.   
  
<https://diary.ru/~zHz00/p210420951_podmenyshi.htm>  
  
Теги:  
[[Программирование]]  
ID: p210420951  


Комментарии: 7
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/7) | 2016-09-15, 08:26 | korrshun | c712205926 |

  
 вот за это я простынки и не люблю.   
 ^c712205926

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/7) | 2016-09-16, 01:13 | zHz00 | c712242812 |

  
 Да, надо от них избавляться, конечно, но умещать каждую функцию на один экран, как велят многие пособия, довольно проблематично. Функция, с которой я имел дело, занимает около 10 экранов. Из неё вызываются штук 20 других функций (в зависимости от разных условий -- те или другие из имеющегося набора). Каждая из этих 20 тоже экранов по 10.   
 ^c712242812

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (3/7) | 2016-09-16, 18:14 | korrshun | c712265270 |

  
 А почему это проблематично? Тяжело выбрать правильную абстракцию с правильным именем, чтобы упаковать и нехай компилятор сам инлайнит? Или это большие из-за того, что кода очень много и страшно что-то трогать из-за большой связности?   
 ^c712265270

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (4/7) | 2016-09-16, 19:13 | zHz00 | c712267509 |

  
 Что-то в последние дни часто стали случаться дабл и трипл посты.   
   
 Больше второе -- делать рефакторинг спагетти нудно, страшно и опасно (а спагетти он был ещё до меня). С абстракциями, конечно, тоже проблемы, т.к. весь процесс делится на эн этапов, и эти этапы уже выделены в функции. А вот найти подэтапы внутри этапов уже сложно. А даже если это сделать, то они используют общие данные, а значит придётся либо всё передавать через параметры, либо все локальные переменные делать членами класса, в котором расположены все вышеописанные функции. Но последнее -- это опять проблемы связности.   
 ^c712267509

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (5/7) | 2016-09-22, 12:27 | Гость | c712491493 |

  
 -Wshadow   
   
 -- Minoru   
 ^c712491493

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (6/7) | 2016-09-22, 13:48 | zHz00 | c712494703 |

  
 Это для какого компилятора?   
 ^c712494703

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (7/7) | 2016-09-22, 13:52 | Гость | c712494866 |

  
 Для GCC. Clang, скорее всего, тоже её принимает. Ну, а у Микрософтовского компилятора должен бы быть аналог.   
   
 -- Minoru   
 ^c712494866