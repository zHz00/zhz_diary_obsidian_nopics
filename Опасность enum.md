Опасность enum
==============

  
2017-04-18, 23:59  
 enum -- что может быть лучше?   
   
  [(для тех кто не в теме)](https://zHz00.diary.ru/p212559860.htm?index=1#linkmore212559860m1)    enum TypeName {SYMBOLIC\_CONSTANT1, SYMBOLIC\_CONSTANT2, SYMBOLIC\_CONSTANT3};   
   
 Потом об'являем   
   
 TypeName var1;   
   
 и ей можно присваивать значения, например:   
   
 var1=SYMBOLIC\_CONSTANT2;   
   
 Другие значения, кроме этих трёх, присвоить нельзя. Назначаются начиная с нуля последовательно. Можно задать напрямую, например:   
   
 enum TypeName {SYMBOLIC\_CONSTANT1=7, SYMBOLIC\_CONSTANT2=3, SYMBOLIC\_CONSTANT3=11};   
   
 Если задать не все, но незаданные будут получать значение, равное предыдущему в списке, плюс один.     
   
 Чем же это опасно? При любом изменении списка, исключая добавление новых констант в конец, меняется фактическая нумерация! И значение, которое было раньше 2, теперь становится 3. Это совершенно некритично, если доступ к переменным завязан ТОЛЬКО на применении символических значений. Как только происходит выход за пределы данного лягушатника -- начинается беда-печаль. Вот примеры:   
 1. Бинарное общение с другой программой, у которой список констант немного отличается.   
 2. Общение самого с собой через файлы. Сохраняем, к примеру, настройки в файл. Обновляем программу, файл считывается, а значение уже не то!   
 3. Использование символических констант в качестве индексов предопределённых массивов. Например:   
   
 enum TypeName {SYMBOLIC\_CONSTANT1, SYMBOLIC\_CONSTANT2, SYMBOLIC\_CONSTANT3};   
 char SymbolicNames[][80]={"Name1", "Name2", "Name3"};   
   
 printf("Name: %s\n",SymbolicNames[SYMBOLIC\_CONSTANT2]);   
   
 Если модифицировать первый список, по индексам будут выпадать чужие имена.   
   
 Что с этим делать:   
 1. Не модифицировать список в середине и в начале. Никогда. (иногда может показаться, что это можно сделать безболезненно... переупорядочить константы по группам, к примеру)   
 2. Присваивать принудительные номера. Всегда. (как это делать, см. под катом в начале)   
 3. Использовать #define .   
  
<https://diary.ru/~zHz00/p212559860_opasnost-enum.htm>  
  
Теги:  
[[Программирование]]  
[[Говнокод]]  
ID: p212559860  


Комментарии: 1
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/1) | 2017-04-20, 18:50 | Knows Ajed | c720793373 |

  
 Резонно.   
 ^c720793373