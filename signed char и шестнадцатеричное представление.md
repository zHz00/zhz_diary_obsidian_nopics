signed char и шестнадцатеричное представление
=============================================

  
2017-04-25, 23:59  
 Допустим, мы хотим увидеть char в шестнадцатеричном виде при помощи printf или аналогичной функции. Это бывает нужно для организации логирования дампов двоичных массивов при приёме/передаче данных, скажем.   
   
 Нас ждёт разочарование. char по умолчанию signed. Спецификатор для шестнадцатеричных чисел -- %x. Но он работает с числами размером с int. signed char будет преобразован в unsigned int, и все старшие биты будут забиты единичками из-за дополнительного кода. То есть, вместо 0x2F мы увидим 0xFFFFFF2F (при форматное строке "0x%02x").   
   
 Что же делать?   
 1. Забыть про массивы char. Использовать либо unsigned char, либо новомодный (лет пять-десять как) uint8\_t.   
 2. Использовать двойное преобразование типов. Это лол. Я не ожидал, что это сработает:   
   
 printf( "0x%02x ",(unsigned int)(unsigned char)buffer[offset]);   
  
<https://diary.ru/~zHz00/p212618849_signed-char-i-shestnadcaterichnoe-predstavlenie.htm>  
  
Теги:  
[[Программирование]]  
ID: p212618849  


Комментарии: 2
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/2) | 2017-04-30, 14:04 | Гость | c721106084 |

  
 В GNU libc для этого есть специальный модификатор hh, благодаря которому можно писать вот так:   
   
 printf("%hhx", buffer[offset]);   
   
 Подробности в мане: manpages.debian.org/jessie/manpages-dev/printf.3.en.html#The\_length\_modifier   
   
 А за упоминание дополнительного кода спасибо. Я, когда с единичками в верхних битах недавно столкнулся, почему-то не догадался, что это с знаковостью связано.   
   
 -- Minoru   
 ^c721106084

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/2) | 2017-04-30, 14:10 | zHz00 | c721106225 |

  
 Minoru   
   
 У меня данная ситуация касалась MSVS, но с ГНУ работать тоже приходится, изучу, спасибо.   
   
 >>Подробности в мане   
   
 Кто такая маня?))   
 ^c721106225