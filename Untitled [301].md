Untitled [301]
==============

  
2014-05-16, 23:57  
 Оказывается, GD в PHP отказывается воспринимать некоторые JPEG-файлы. А именно, функции работы с JPEG выдают предупреждения, хотя всякие просмотрщики изображений отображают файл нормально. Виной тому (в обнаруженном мной случае) являются лишние данные (откуда?)   
   
 Предупреждение об ошибке со стороны специализированных утилит выглядит примерно так:   
   
 Extraneous 12345 padding bytes before section 0xE2   
   
 Что можно с этим сделать:   
 1) Пофиксить файл с помощью jpegtran с параметрами -copy all и -perfect. Минус: у меня файл уменьшился в размере на большее число байт, чем было лишних. Возможно, всё-таки происходит перекодирование?   
 2) Отключить предупреждения в PHP. Для этого есть опция gd.jpeg\_ignore\_warning. Минус: getimagesize всё равно возвращает FALSE.   
  
<https://diary.ru/~zHz00/p197566870_untitled-301.htm>  
  
Теги:  
[[Программы]]  
[[Программирование]]  
ID: p197566870  


Комментарии: 7
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/7) | 2014-05-17, 12:54 | deadlymercury | c666027271 |

  
 Может быть, EXIF?   
 Еще вариант - кто-то добавил в жпеги код ![:)](http://static.diary.ru/picture/3.gif) Я такое видел на поломанных сайтах - cat'ом бинарный жпег (точнее, первая пара строчек) вполне читалась, но при этом сама картинка открывалась. Правда к картинке еще POST-запросы производились ![:)](http://static.diary.ru/picture/3.gif)   
 ^c666027271

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/7) | 2014-05-17, 17:49 | zHz00 | c666041230 |

  
  [deadlymercury](http://crazysupp.diary.ru "Записки безумного саппорта")  , EXIF есть, но с ним всё в порядке. Код тоже может быть, но я открывал файл ноутпадом -- там обычные жпег-заголовки. Т.е. именно перед маркером 0xE2 лишние байты. Но тут надо курить структуру жпега, чтобы что либо понять. Мне лень.   
 ^c666041230

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (3/7) | 2014-05-18, 13:01 | deadlymercury | c666084084 |

  
 хм, тогда другой вариант - о таком читал на хабре про капчи (которые крутить надо). Чтобы роботы не гадали капчку по размеру картинки - размер искусственно подгонялся под одинаковый, в картинку добавлялся мусор.   
 ^c666084084

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (4/7) | 2014-05-27, 23:32 | падрэ Алькадес | c666778922 |

  
 Маковские смотрелки и графредакторы шалят. Попробую угадать - примерно 3-4 кб прибавляется?   
 ^c666778922

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (5/7) | 2014-05-27, 23:41 | zHz00 | c666779848 |

  
  [падрэ Алькадес](http://alkades.diary.ru "Кусок, не спи, нам на следующей.")  , нет, наоборот, размер сокращается!   
 ^c666779848

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (6/7) | 2014-05-27, 23:53 | падрэ Алькадес | c666780971 |

  
  [zHz00](https://zHz00.diary.ru "Untitled")  , я имею в виду, что проблемные файлы имеют 3-4 кб "лишних" по сравнению с беспроблемными?   
 ^c666780971

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (7/7) | 2014-05-28, 07:46 | zHz00 | c666792583 |

  
  [падрэ Алькадес](http://alkades.diary.ru "Кусок, не спи, нам на следующей.")  , а, да. Это возможно. Но они что, в нарушении стандарта это делают?   
 Сведения такие: это некий фотосет, сделанный некоей камерой, что подтверждается EXIF-данными. Из сотни или около того фоток  **три**  обладают данной проблемой, а остальные нет. В одной примерно 6 лишних килобайт, в другой 20, в третьей 50.   
   
 Ещё один момент -- фотки точно подвергались обработке редактором. По этому поводу в EXIF -- Adobe Photoshop Lightroom 5.3 (Windows). В некоторых из нормальных. А в тех трёх -- Adobe Photoshop 7.0. Что в остальных -- не проверял. Так что это, возможно, действительно косяк программы.   
 ^c666792583