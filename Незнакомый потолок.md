Незнакомый потолок
==================

  
2022-03-18, 04:38  
 Пусть надо передать пакет по физическому каналу связи от устройства А до устройства Б. Длина пакета известна. Устройство Б принимает байты, пока буфер не заполнится, а потом начинает разбор пакета.   
   
 Но это идеальный случай. Канал связи реальный, и в нём могут происходить сбои. Когда произошёл сбой, в буфере оказывается мусор. Заполнили буфер -- попытались разобрать -- выбросили. Заполнили ещё раз. Но из-за изначальной ошибки у нас начало пакета оказывается в середине буфера, а не в начале. Поэтому сколько буфер не выбрасывай, начало очередного пакета мы не найдём. Это потеря синхронизации.   
   
 Такая ситуация обязательно должна быть предусмотрена разработчиками. Алгоритма разрешения тут два:   
 1. Сброс буфера по тайм-ауту. Если слишком долго нет очередного байта, то делается вывод о том, что пауза между пакетами попала на середину буфера. Надо выбросить неполный буфер и начать приём сначала.   
 2. Поиск синхронизации по сигнатуре. Сигнатура -- это фиксированные, заранее известные байты, которые всегда следуют в начале любого пакета. Если сигнатура обнаруживается в середине пакета, а в начале пакета её нет, то у нас пропала синхронизация. Надо, опять-таки, выбросить текущий буфер, а принятую только что сигнатуру записать в начало.   
  
<https://diary.ru/~zHz00/p221114786_neznakomyj-potolok.htm>  
  
Теги:  
[[Программирование]]  
[[Борьба с техникой]]  
ID: p221114786  


Комментарии: 2
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/2) | 2022-03-18, 20:37 | Xersareeth | c753860860 |

  
 3. Проследить чтобы в буфер гарантированно помещалось 2-3 пакета. Искать начало пакета по сигнатуре.   
 ^c753860860

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/2) | 2022-03-18, 21:03 | zHz00 | c753861004 |

  
  [Xersareeth](https://BurrowDeclassified.diary.ru "One more fang")  , да. Особенно это может быть эффективно при пакетах переменной длины.   
 ^c753861004