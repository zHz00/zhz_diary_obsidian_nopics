Эффект бабочки
==============

  
2014-11-12, 23:45  
 В программе был список из некоторых элементов. В процессе его обработки я часть элементов копировал в другие места списка. Список расширялся.   
   
 Потом я стал модифицировать список. Некоторые элементы получили новые значения.   
   
 На определённом этапе я обнаружил, что элементы списка содержат неожиданные данные. А именно: я изменил лишь один элемент списка некоторого типа, однако по факту изменились  *все*  элементы этого типа. Хмм...   
   
 Догадались?   
   
 Это, оказывается, был список  *указателей*  на об'екты. И при копировании я копировал тоже указатели, а не создавал новые элементы. Таким образом, изменение одного элемента внешне изменяло все, которые на него ссылались (то есть, все, которые я как бы "скопировал").   
  
<https://diary.ru/~zHz00/p201001284_jeffekt-babochki.htm>  
  
Теги:  
[[Программирование]]  
ID: p201001284  


Комментарии: 5
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/5) | 2014-11-13, 20:46 | Knows Ajed | c677925375 |

  
 Пичальная история, легко вляпаться, не так просто лечить последствия, но на стадии дебага терпимо...   
 ^c677925375

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/5) | 2014-11-13, 21:38 | zHz00 | c677929698 |

  
  [Knows Ajed](http://Who-Knows-Ajed.diary.ru "Who Knows Ajed?")  , к счастью, выход такой ошибки за пределы отладки крайне затруднён. По крайней мере, если модификации данных не носят единичный характер. Вообще, я просто не осознавал, что это указатели, хотя обращался к ним через стрелку. Если бы осознавал, такого бы не случилось. А вот почему не осознавал -- вопрос. Переменную со списком делал не я, поэтому я использовал её готовую -- может быть, поэтому.   
 ^c677929698

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (3/5) | 2014-11-13, 22:07 | Knows Ajed | c677932328 |

  
  [zHz00](https://zHz00.diary.ru "Untitled")  , вообще, со стрелкой у меня была похожая проблема - она почему-то "приучала к мысли", что тут, вроде как, и не пахнет "низкоуровневым", "плебейским" указателем, а вполне всё такое объектное, "само собой делающееся" - типа где-то ко всему этому где-то прикручены конструкторы копирования и т.д. Ан, ведь, нет.   
 ^c677932328

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (4/5) | 2014-11-13, 22:52 | zHz00 | c677936379 |

  
  [Knows Ajed](http://Who-Knows-Ajed.diary.ru "Who Knows Ajed?")  , кстати, в Делфи в этом смысле хуже. Там доступ через указатель и через объект -- всё точка. Она автоматом определяет -- указатель или нет и разыменовывает его, либо не разыменовывает. Облегчается дело тем, что все объекты классов нужно создавать, насколько я помню. Как непосредственные объекты остаются только записи.   
 Т.е.:   
   
 type   
 CType1=record   
 // описания полей   
 end;   
 CType2=class   
 // описание полей и методов   
 end;   
   
 var   
 c1:CType1;   
 // c1 -- обычная переменная   
 c2:CType2;   
 // думаете, c2 -- переменная? нет, указатель!   
   
 begin   
 c2= CType2.Create;   
 //выделение памяти   
 c2.field1:=2;   
 с2.Method;//вызов метода   
   
 c1.field1:=3;   
 // а тут можно ничего не создавать   
 //...   
 ^c677936379

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (5/5) | 2014-11-15, 03:27 | Knows Ajed | c678018205 |

  
  [zHz00](https://zHz00.diary.ru "Untitled")  , ну, у дельфей своя специфика, с паскалевских времён. Оно ведь вообще изначально задумывалось как хороший, качественный язык для обучения программированию. И object pascal был вынужден жить с необходимостью обратной совместимости эм... парадигмы программирования с "предками". Впрочем, кому я рассказываю... % ) Я бы ещё Пушкину про стихи пошёл лекции читать.   
   
 Это, как его. Лично мне дельфевский подход нравится меньше. Сишный в этом плане несколько "честнее", хотя, конечно, и значительно более "неопределённый", пожалуй. Как говорится, тысяча и один способ выстрелить в ногу. Не обязательно себе.   
 ^c678018205