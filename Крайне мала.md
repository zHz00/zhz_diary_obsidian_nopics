Крайне мала
===========

  
2022-05-14, 02:59  
 Все знают, что числа float нельзя сравнивать на равенство друг с другом. Потому что в результате расчётов одно число будет 1.999, а другое 2.001. И они будут не равны. Обычно используют формулу типа:   
 fabs(a1-a2)<EPS   
 то есть сравнивают разность с определённым небольшим числом. Так делал и я.   
   
 Итак, надо было привести в движение деталь очередным шаговым двигателем. Переместиться на заданное расстояние fDistance. В связи с некоторыми особенностями алгоритмов размер перемещения периодически бывал равен нулю. В этих случаях никуда перемещаться было не надо, иначе возникали неожиданные последствия. То есть, если перемещение равно нулю, то команду надо было игнорировать.   
   
 Ну, я написал:   
   
 if(fabs(fDistance)>EPS) Move(fDistance);   
   
 EPS я задал 0.0001, поскольку характерные значения минимальных настоящих перемещений были в районе 1.0 .   
   
 Во всех этих сравнениях есть один тонкий момент. На точное равенство с нулём на самом деле сравнивать МОЖНО, хотя и не нужно. Потому что сам ноль имеет в форматах float/double точное, а не приближённое представление. Если величина изначально задаётся нулём при инициализации, или через настроечный файл, то сравнения будут работать корректно. А вот если ноль является результатом вычислений, тут уже возникают проблемы.   
   
 Итак, ноль у меня являлся результатом вычислений, при которых сырые величины умножались на коэффициент преобразования, чтобы получились величины физические.   
   
 ОКАЗАЛОСЬ,   
   
 что нулевое перемещение после расчётов периодически оказывается равно 0.001, а это больше моего EPS. В результате команда Move вызывалась.   
   
 Пришлось поставить EPS==0.1.   
  
<https://diary.ru/~zHz00/p221188529_krajne-mala.htm>  
  
Теги:  
[[Программирование]]  
[[Борьба с техникой]]  
ID: p221188529  


Комментарии: 2
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/2) | 2022-05-21, 20:50 | Гость | c754158489 |

  
  Все знают, что числа float нельзя сравнивать на равенство друг с другом.    
   
 «Все с детства знают, что то-то и то-то невозможно. Но всегда находится невежда, который этого не знает. Он-то и делает открытие» ­— Альберт Эйнштейн   
   
 -- Minoru   
 ^c754158489

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/2) | 2022-05-21, 20:52 | zHz00 | c754158508 |

  
 Minoru, да, надо было написать "с детства"))   
 ^c754158508