Сериализация
============

  
2013-01-11, 23:48  
 Если у вас есть "мёртвая" структура, в которой только одни данные, её лучше всё равно не записывать на диск как побайтовую копию структуры в памяти (а потом так же считывать её обратно), по крайней мере по двум причинам.   
 1. Если вы случайно (случайно?!) перекомпилируете с другим выравниванием по границам байт, слов, двойных слов (#pragma pack(n)), вы из сохранённого файла нифига не прочтёте.   
 2. Если вам придётся изменить структуру (а её придётся изменить, даже если вы 100% уверены, что она никогда меняться не будет), файл опять-таки станет непригодным для чтения.   
   
 Ну а если структура не мёртвая, а в ней есть другие об'екты-классы с системой выделения памяти, то это вообще атас и вы дерьма не оберётесь (сам проверял) пытаясь сначала считать с диска об'ект как есть, а потом чинить указатели и прочее.   
   
 Если об'ект нужно сохранять на диск, очень лучше сделать отдельные функции по сохранению его на диск (или хотя бы в массив байтов) и по чтению с диска (это и называется сериализацией). Лучше всего делать их как методы класса (структуры). Они должны по одному читать (писать) поля об'екта (это может показаться очень муторным, тогда в можете воспользоваться  [одним трюком](Программирование%20на%20Си%20с%20помощью%20Excel)  ). При этом следует уделить особое внимание версии об'екта и записывать её тоже, чтобы при изменении формата об'екта (т.е. создании новой версии его) можно было продолжать считывать в него старые данные.   
   
 Благодарность за вразумление: himself'у.   
  
<https://diary.ru/~zHz00/p184411875_serializaciya.htm>  
  
Теги:  
[[Программирование]]  
[[Очевидное-невероятное]]  
ID: p184411875  


Комментарии: 6
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/6) | 2013-01-12, 09:34 | korrshun | c623612140 |

  
 а еще лучше не писать свои костыли и взять brotobuf или json или xml библиотеки в зависимости от.   
 ^c623612140

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/6) | 2013-01-12, 19:21 | Гость | c623655603 |

  
 ![](http://demotivators.to/media/preview/63956_nelzya-prosto-tak-vzyat_demotivators_ru.jpg)   
 ^c623655603

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (3/6) | 2013-01-12, 20:04 | zHz00 | c623660138 |

  
  **Гость**  , ?   
  [korrshun](http://Igel-kun.diary.ru "kimi wo shiranai monogatari")  , то, что вы пишете, мне неведомо. Буду искать это, спасибо. Но хмл мне не подходит, потому что та хрень, которую мне надо сохранять внедрена в другую хрень, у которой заведомо двоичный формат. И вообще хмл вызывает у меня какое-то ощущение одновременно паттерна и анти-паттерна. Что, надо что-то сохранить? Лепим хмл не думая!   
 ^c623660138

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (4/6) | 2013-01-12, 20:21 | korrshun | c623661950 |

  
  [demotivators.to/media/preview/63956\_nelzya-pros...](http://demotivators.to/media/preview/63956_nelzya-prosto-tak-vzyat_demotivators_ru.jpg)  - очень трогательная ссылка.   
 по-моему мнению xml это тоже кроваво, с точки зрения времени обработки и того сколько оно жрет памяти,   
 но хорошо тем, что написана уже гора библиотек для него, есть условно полезные, пускай и монструозные стандарты (xsd, xml-rpc) и можно с такой-то матерью распарсить содержимое, даже если сам xml кривой по самое немогу - весь современный веб это доказывает.   
 ^c623661950

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (5/6) | 2013-01-12, 21:40 | zHz00 | c623671389 |

  
  [korrshun](http://Igel-kun.diary.ru "kimi wo shiranai monogatari")  ,   
 403 Forbidden   
 nginx   
   
 это ваша трогательная ссылка. И я кажется понял, почему пост гостя пустой.   
 ^c623671389

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (6/6) | 2013-01-13, 08:28 | korrshun | c623713976 |

  
 название картинки все объясняет   
 ^c623713976