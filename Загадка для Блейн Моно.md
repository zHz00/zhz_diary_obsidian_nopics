Загадка для Блейн Моно
======================

  
2024-02-29, 02:05  
 Программы, отрабатывающие в командной строке, никогда не должны зависать. Если они что-то сделать не могут, то надо выдавать сообщение об ошибке и завершаться.   
   
 Почему? Потому что вызов может быть частью более сложной системы. Это задача скрипта -- выяснить, что не получилось, и отработать ошибку. А задача программы -- не нарушить остальную систему.   
   
 Записать этот тезис меня сподвигла такая программа, как mediainfo.exe . Я решил ей обработать определённый каталог. Я написал короткий бат-файл с командой for, которая обходила все файлы по дереву и сдавала их mediainfo.exe, а вывод этой команды отправлялся в файл. Что могло пойти не так?   
   
 Файлов в папке было много, разных типов. Конечно, не все из них являлись медиа. Но сидеть и думать над списком расширений -- это не моё. Я обработал все файлы. Медиаинфо нормально относится к тому, что ему дают не-медиа файл. В этом случае он выводит только его размер. Я думал, что проблем возникнуть не может. Но они возникли.   
   
 Среди файлов нашёлся один не-медиа-файл, который не обрабатывался. Медиаинфо на нём просто зависал без выдачи каких-либо сообщений. Я пошёл гуглить, и обнаружил, что этот случай не единичный. Пользователи периодически жалуются разработчику в том числе и на медиа-файлы, на которых медиаинфо зависает. Далее они отправляют файл разработчику, он что-то исправляет, и в следующей версии всё нормально.   
   
 Пока не найдётся следующий такой файл.   
   
 Это означает, что в программе систематическая проблема, при которой входной файл может её повесить. А исправляются, по-видимому, только конкретные случаи.   
   
 Не знаю. что тут можно сделать. Лучше всего -- выяснить, в чём корень проблемы. Но если это невозможно... сделать отдельный поток с watchdog-таймером?..   
  
<https://diary.ru/~zHz00/p221934581_zagadka-dlya-blejn-mono.htm>  
  
Теги:  
[[Программирование]]  
[[Борьба с техникой]]  
ID: p221934581  


Комментарии: 3
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/3) | 2024-02-29, 02:39 | Foul thing | c757711946 |

  
 Запускай mediainfo из-под своей программы, которая и будет держать таймер. Если mefiainfo долго не отвечает, убивай ее и перезапускай.   
 ^c757711946

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/3) | 2024-02-29, 06:49 | zHz00 | c757789152 |

  
  [Foul thing](https://foulthing.diary.ru "Temporary Internet Flies")  , да, это будет нормальное решение. Вместо этого я сделал исключение -- при совпадении имени файла с проблемным, файл пропускается. Для одного файла это можно сделать из бат-файла без проблем.   
 ^c757789152

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (3/3) | 2024-02-29, 09:32 | Xersareeth | c757838617 |

  
 Я бы начал с рассмотрения альтернатив. ffprobe, например.   
 ^c757838617