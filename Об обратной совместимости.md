Об обратной совместимости
=========================

  
2011-11-23, 00:54  
 В винде есть баг. Его многие замечали, наверное. Если программа, имеющая иконку в трее, падает, иконка продолжает висеть, пока не наведёшь на неё мышку. Этот баг прошёл красной нитью со времён Windows 95 и сохранился даже в семёрке.   
   
 Только что я узнал, что в Windows CE 5.0 он тоже есть.   
  
<https://diary.ru/~zHz00/p169582904_ob-obratnoj-sovmestimosti.htm>  
  
Теги:  
[[Программы]]  
ID: p169582904  


Комментарии: 3
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/3) | 2011-11-23, 10:48 | himself | c575422817 |

  
 Наверное, дело в том, что потерю DCOM-объекта нельзя обнаружить до вызова очередной его функции. А это, в свою очередь, потому, что когда программа рушится, только системный слой может в принципе кого-то о чём-то уведомить. Он же к DCOM отношения не имеет, вот и не заморачивается докладывать клиентам DCOM, что сервера больше нет.   
   
 Другим вариантом было бы организовать пинги (кипалайвы), такое опционально есть между компьютерами (но тоже с кучей проблем, о которых позже). Однако даже между компами пингуется только подключение DCOM hub - DCOM hub, и если местный DCOM hub о падении сервера пока не знает, он удалённому хабу не сообщит.   
   
  Бонусная дорожка. Ради экономии траффика кипалайв шлётся общий на все подключения между парой ПК.   
   
 Клиент1, клиент2, клиент3 -> DCOM Hub -----(кипалайв)--- DCOM Hub -> Сервер1, сервер2, сервер3.   
   
 Поэтому он страдает от проблем с безопасностью COM. Каждое подключение может совершаться как от дефолтного юзера (с доменной безопасностью), так и прямо указывать логин и пароль в программе.   
   
 Клиент1 ----(логин: текущий пользователь)- Сервер1   
 Клиент2 ----(логин: pupkin2004)- Сервер2   
 Клиент3 ----(логин: fedotov)- Сервер3   
   
 Когда домена нет, остаётся только второе. Но поскольку кипалайв шлётся общий на все подключения, ему задать логин и пароль нельзя. Он ведь не может подключиться сразу по трём логинам (текущий, pupkin2004 и fedotov). Ему нужен какой-то один.   
   
 Так что DCOM-канал кипалайва всегда авторизуется текущим пользователем на клиентском компе. Если авторизация не удалась, он подключается анонимно. Но анонимный вход часто вообще отключен по всему компьютеру. Получается, что в бездоменной сети, где анонимный доступ запрещён, кипалайвы работать не могут.   
   
 И это действительно так: на таких компах все DCOM-подключения отваливаются раз в несколько минут по таймауту. Приходится отказываться от кипалайвов или включать анонимный доступ.    
 ^c575422817

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/3) | 2011-11-23, 22:10 | zHz00 | c575509131 |

  
  [himself](/~himself/ "void")  , ты хочешь сказать, что иконка в трее работает через DCOM?   
 ^c575509131

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (3/3) | 2011-11-23, 22:23 | himself | c575511422 |

  
  [zHz00](/~zHz00/ "Untitled")  , через COM, который его частный случай. Out-of-process COM server.   
 ^c575511422