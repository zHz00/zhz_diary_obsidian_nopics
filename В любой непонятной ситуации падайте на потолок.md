В любой непонятной ситуации падайте на потолок
==============================================

  
2014-09-08, 23:52  
 Оказалось, что программа возвращает для отрицательных чисел результат на единицу больше (ближе к нулю), чем нужно. Для положительных работает нормально. Смотрим в книгу, видим фигу:   
   
 x=int(a+0.5);   
   
 Эта штука и правда округляет правильно только положительные числа. Слава богу, её писал не я. Она в коде уже много лет, но случаев, когда эта разница в единицу была бы важна, раньше не было. Тут у меня в голове что-то скребётся... где-то я уже что-то такое видел, хм... и тут я вспоминаю, как правильно!   
   
 x=floor(a+0.5);   
   
 Заработало!   
   
 Но где, где же я видел это правильную запись округления в Си? В книжке  [Бобровского](http://www.twirpx.com/file/15494/)  . Мне её купили, когда я ещё в школе увлекался Си++ Билдером (я и сейчас его сильно уважаю). Тогда-то я её прочитал с интересом, но сейчас понимаю, что книжка -- не очень. Это первый случай, когда та книжка оказалась полезной.   
  
<https://diary.ru/~zHz00/p199786778_v-lyuboj-neponyatnoj-situacii-padajte-na-potolok.htm>  
  
Теги:  
[[Программирование]]  
[[Борьба с техникой]]  
ID: p199786778  


Комментарии: 4
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/4) | 2014-09-09, 02:26 | Гость | c673580374 |

  
 Опять ничего не понял.   
 ^c673580374

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/4) | 2014-09-09, 10:58 | Foul thing | c673590073 |

  
 А самому написать?   
   
 return a > 0 ? int(a+0.5) : int(a-0.5);   
 ^c673590073

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (3/4) | 2014-09-09, 11:47 | korrshun | c673592552 |

  
 это еще повезло, что надо всегда округлять в большую сторону.   
 Вот на такие грабли IEEE 754 надо тоже наступать с осторожностью:   
 round((0.3 - 0.2) \* 10.0 + 0.5)   
 ^c673592552

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (4/4) | 2014-09-09, 16:40 | Гость | c673610161 |

  
 Чорт, они все это понимают...   
 ^c673610161