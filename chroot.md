chroot
======

  
2020-08-01, 23:59  
 У микроконтроллеров туго с энергонезависимой памятью. Если надо хранить настройки, то приходится это делать обычно в основной флешке микроконтроллера. Встаёт вопрос -- где и как в этой флешке их хранить. Но это тема для отдельной статьи. Часто советуют просто писать куда-нибудь в конец флешки, где почти наверняка никаких данных не будет. Это методически неправильно, конечно, но работает.   
   
 Обычно система такая. Прошивка грузится и считывает зону настроек. Если она определяет, что зона повреждена или пустая -- грузятся настройки по умолчанию (и сразу сохраняются в зону). Если зона в порядке, настройки берутся оттуда.   
   
 Вы сделали прошивку с настройками по умолчанию. Прошиваете -- а они не применяются. Несколько раз меняете настройки, а они всё равно не применяются. В чём дело?   
   
 В том, что настройки считываются из конца флешки. Да, вы осуществили перепрошивку, но прошивальщик затёр не всю флешку, а только те куски, которые он собирается прошивать. В нормальной ситуации это бы дало хороший результат, но не в нашей, когда в конце флешки нелегально тусуются настройки. Поскольку эта зона по мнению прошивальщика/линкера свободная, то и незачем её чистить.   
   
 Иногда в среде разработки есть настройка "очищать флеш-память микроконтроллера полностью". Если её поставить -- проблема пропадёт. Но если такой настройки нет, то придётся перед каждой прошивкой вручную чистить память при помощи отдельной утилиты.   
  
<https://diary.ru/~zHz00/p219749546_chroot.htm>  
  
Теги:  
[[Программирование]]  
[[Борьба с техникой]]  
ID: p219749546  


Комментарии: 4
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/4) | 2020-08-02, 22:35 | Стороной | c748349896 |

  
 Почему туго? EEPROM как правило есть.   
 ^c748349896

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/4) | 2020-08-02, 22:59 | zHz00 | c748350245 |

  
  [Стороной](http://1047.diary.ru "Сторона 1")  , погуглил. Походу просто мне попадаются такие МК, где нет еепром! Написано, что в стм32 их обычно нет, а ещё я работал с пик32 -- и насчёт них я не уверен, есть там или нет, но судя по тому, что разработчик электроники поставил отдельную энергонезависимую память на плату -- там тоже нет.   
 ^c748350245

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (3/4) | 2020-08-02, 22:59 | Стороной | c748350257 |

  
  [zHz00](https://zHz00.diary.ru "Untitled")  , я с AVR работал, так там обычно есть )   
 ^c748350257

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (4/4) | 2020-08-02, 23:09 | zHz00 | c748350412 |

  
  [Стороной](http://1047.diary.ru "Сторона 1")  , я в авр "работал" только на лабах в институте))) Окей, записываю, в аврках есть еепром. Спасибо.   
 ^c748350412