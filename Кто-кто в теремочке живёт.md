Кто-кто в теремочке живёт?
==========================

  
2023-05-03, 03:48  
 Было у меня две железки, изготовленных в соседней организации. Одна чуть более старая, другая чуть более новая.   
   
 Старая находилась внутри установки и работала неправильно. У меня было джва варианта:   
 1. Перепрошить старую железку новой прошивкой, надеясь, что там баг исправлен.   
 2. Заменить старую железку новой железкой, где прошивка уже новая.   
   
 Я решил пойти по второму пути, но старую всё равно пришлось бы прошивать, поэтому я связался с разработчиком и попросил последнюю версию прошивки. Когда-то, несколько месяцев назад, мы отлаживали эту железку, и разработчик присылал мне этих прошивок очень много. Но какая же из них была правильная? Последняя по дате-времени? Не факт! Лучше пусть сам мне пришлёт то, что надо.   
   
 Разработчик предложил мне своеобразное решение. Прошивка в данном устройстве не шифруется и не заблокирована от считывания. Можно скачать прошивку с новой железки и прошить в старую.   
   
 Тем не менее, я настоял на свежей сборке.   
   
 Сначала это показалось мне капризом. Типа, борьба за перфекционизм. Или желание перевесить часть работы на другого.   
   
 Но потом я обнаружил целых две причины, почему прошивать заведомо известные версии прошивок -- это правильно.   
   
 Первая причина: оказалось, что баг присутствует в новой железке тоже. Это означало одно из двух: либо прошивка новой железки всё же недостаточно новая, либо баг сохранился в новой прошивке. И при том, и при другом случае копирование прошивки из одной железки в другую не улучшило бы ситуацию. Поэтому лучше сразу заливать заведомо известную новую версию. Это исключит вероятность проявления тех багов, которые уже были исправлены ранее.   
   
 Вторая причина: если баг сохраняется даже в последней версии прошивки, тогда мы будем знать, что именно эта версия прошивки содержит баг. И, та-дам! У нас есть исходный текст, из которого мы только что прошивку собрали. С этим можно работать.   
   
 Частично такие проблемы можно (и нужно!) решать административным способом: а именно, каждая "стабильная" версия прошивки должна внутри себя содержать свой идентификатор, а разработчик должен иметь возможность вернуться к любой из выпущенных версий. Но мы живём не в сказке, а в реальности. И, увы, в реальности разработчики могут следить за коммитами, но могут не следить за их нумерацией в тексте прошивки. Эта ситуация усугубляется, если разработчик находится в отладочном угаре. В таких случаях я и сам номер версии не ставлю. Не до того.   
   
 Ещё немного про версии прошивок:  [diary.ru/~zHz00/p214802379\_o-versionnosti.htm](О%20версионности)    
  
<https://diary.ru/~zHz00/p221620453_kto-kto-v-teremochke-zhivyot.htm>  
  
Теги:  
[[Программирование]]  
[[Говнокод]]  
ID: p221620453  


Комментарии: 4
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/4) | 2023-05-03, 11:09 | CD\_Eater | c755677884 |

  
  если разработчик находится в отладочном угаре    
 а вот об этом личном опыте поподробнее пжлст   
 ^c755677884

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/4) | 2023-05-06, 23:35 | Гость | c755688323 |

  
  в реальности разработчики могут следить за коммитами, но могут не следить за их нумерацией в тексте прошивки    
   
 Обычно это решают добавлением дефайна, значение которого берётся из гита:   
   
 CFLAGS += "-DVERSION=$(git describe --abbrev=4 --dirty --always --tags)"   
   
 И потом выводить эту версию в --help; микроконтроллер, наверное, будет писать её в какой-то регистр или отдавать в ответ на какой-то запрос. Это пример для GCC/Clang и Make, но я думаю, что смысл понятен.   
   
 -- Minoru   
 ^c755688323

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (3/4) | 2023-05-07, 18:10 | CD\_Eater | c755689862 |

  
 > git describe --abbrev=4 --dirty --always --tags   
   
 а что должно получиться?   
 я попробовал на репе без тегов, он просто вернул первые 5 цифр HEAD-коммита   
 более информативным было бы писать дату этого коммита, а не SHA-значение   
 ^c755689862

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (4/4) | 2023-05-07, 20:22 | zHz00 | c755690184 |

  
  **Гость**  , Minoru, да, я как раз раздумываю над чем-то подобным, только под винду. Там это сделать не так просто, но я уверен, что возможно.   
   
  [CD\_Eater](https://cd-eater.diary.ru "Записки ДискоЕда")  , а если в день было несколько коммитов?)   
   
 Вообще, у меня "ручной" номер версии как раз состоит из даты. Если (редко) получается больше одного "релиза" в день, то я помечаю завтрашним числом.   
 ^c755690184