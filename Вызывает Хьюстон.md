Вызывает Хьюстон
================

  
2017-08-24, 23:54  
 Есть два измерительных устройства. Они выполняют одну функцию, поэтому мы подключаем к установке только одно из них. Смотря что есть. Одно работает через виртуальный COM-порт. Другое -- USB.   
   
 Включили USB-вариант. На старом компьютере работает, на новом не работает. На это раз, в отличие от  [предыдущего случая](Шерлок%20Х.)  , и компы, и ПО полностью одинаковые.   
   
 По логам выходит, что устройство всё-таки включено, но показометр почему-то не показывает. Идущее в коплекте с устройством тестовое ПО результат показывает, т.е. устройство исправно, а дело в нашем ПО.   
   
 В процессе отладки выясняется, что хотя логи и показывают, что устройство включено, фактически данные с него не считываются. А конкретно -- не запускается поток считывания данных. Но на другом компе поток запускается. Почему же?   
   
 Потому что я лох.   
   
 Я сделал в своё время автоматическое определение, включено устройство или нет. Делалось оно так:   
 1. Попробовать открыть COM-порт с фиксированным номером (жёстко зашито в код). Номер тринадцать, если что.   
 2. Если удалось, то включено устройство первого типа.   
 3. Если не удалось, поискать USB-устройство.   
 4. Если USB-устройство обнаружено, то включено устройство второго типа.   
 5. Если ничего нет -- устройства отсутствуют, работаем так (это факультативный модуль).   
   
 Обратите внимание на второй пункт. Проверяется только возможность открытия порта. Кто там висит -- никого не волнует. Кроме того, имеется любопытное последствие -- если порт открылся, проверка USB-устройства уже не производится.   
   
 В наших компьютерах и без этого устройства много устройств, которые видны как COM-порты. И винда их распределяет случайным образом. И вот на втором компе по случайности 13-й порт существовал (хотя к нему ничего не было подключено). И программа думала, что установлено устройство первого типа. И запускала поток считывания данных для устройства первого типа. Он слал запросы... в космос.   
  
<https://diary.ru/~zHz00/p213551610_vyzyvaet-hyuston.htm>  
  
Теги:  
[[Борьба с техникой]]  
ID: p213551610  


Комментарии: 7
--------------

  


---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (1/7) | 2017-08-25, 01:30 | Стороной | c724671267 |

  
 Это да, виртуальные ком-порты имеют хз какие номера...   
 ^c724671267

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (2/7) | 2017-08-25, 01:50 | zHz00 | c724671448 |

  
 Реальные тоже.   
 ^c724671448

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (3/7) | 2017-08-25, 02:01 | Стороной | c724671565 |

  
  [zHz00](https://zHz00.diary.ru "Untitled")  , реальные таки привязаны к железным адресам...   
 ^c724671565

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (4/7) | 2017-08-25, 02:25 | zHz00 | c724671724 |

  
 Да, но как это связано с номерами?..   
 ^c724671724

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (5/7) | 2017-08-25, 12:09 | Стороной | c724678084 |

  
  [zHz00](https://zHz00.diary.ru "Untitled")  , ну смотря про какие железные речь. USB-RS232 да, у них в принципе тоже вирутальный компорт получается. А вот именно родной, железный, там всё ясно: 0x3F8 в IO области - это COM1 и никак иначе.   
 ^c724678084

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (6/7) | 2017-08-26, 23:34 | Stigravian Shaderstill | c724722586 |

  
  Есть два измерительных устройства.    
 Прочитал "омерзительных устройства". Прочитал ещё раз правильно. Подумал, что первое прочтение к тегу больше подходит.   
 ^c724722586

---



|         #         |              Дата              |                     Автор                     |           ID           |
| --- | --- | --- | --- |
| (7/7) | 2017-08-26, 23:49 | zHz00 | c724723081 |

  
  [Stigravian Shaderstill](http://stigravian.diary.ru "Science, Death, Rock-n-Roll")  , с устройствами-то всё нормально...   
 ^c724723081